"0","gp <- as.numeric(group) - 1"
"0","beta0 <- seq(0, 6, length.out = length(gp))"
"0","beta1 <- seq(0, 6, length.out = length(gp))"
"0","sigma <- seq(1, 10, length.out = length(gp))"
"0","ll3 <- function(theta1, theta2, theta3) {"
"0","   "
"0","  if(length(theta1) < length(gp)) {"
"0","     theta1 <- rep(theta1, len=length(gp))"
"0","  }"
"0","  "
"0","  if(length(theta1) < length(gp)) {"
"0","     theta1 <- rep(theta1, len=length(gp))"
"0","  }"
"0","  "
"0","  ## Recycle arguments "
"0","  n = length(weight) "
"0","  m = max(length(theta1), length(theta2)) "
"0","  "
"0","  ## Vector calculation "
"0","  ans = dnorm("
"0","    rep(weight, m), "
"0","    rep(theta1, each=n), "
"0","    rep(theta2, each=n), "
"0","    log=TRUE"
"0","  ) "
"0","  "
"0","  dim(ans) = c(n, m) "
"0","  "
"0","  colSums(ans)"
"0","  "
"0","  # ans = numeric(length(theta1)) "
"0","  # "
"0","  # for(i in 1:length(ans)) {"
"0","  #   density <- dnorm(weight, theta1[i], theta2[i], log=TRUE)"
"0","  #   ans[i] = sum(density) "
"0","  # } "
"0","  # "
"0","  # ans "
"0","}"
"0","mu <- numeric(length(gp))"
"0","for(i in 1:length(gp)) {"
"0","  mu[i] <- beta0[i] + gp[i] * beta1[i]"
"0","}"
"0","z <- outer(mu, sigma, ll3)"
"0","i <- which(z == max(z), TRUE)"
"0","theta <- c(beta0[i[1]], beta1[i[1]], sigma[i[2]])"
"0","ll <- function(theta) { "
"0","  sum(dnorm(weight, theta[1] + gp * theta[2] , theta[3], log=TRUE))"
"0","}"
"0","z <- suppressWarnings(optim(theta, ll, control = list(fnscale=-1), method=""BFGS"", hessian = TRUE))"
"0","(params <- z$par)"
"1","[1]"
"1","  5.0319700"
"1"," -0.3709647"
"1","  0.6606655"
"1","
"
